# EPIC-1 Truth Capture (Event-Driven SoE + SoI) â€” Reference Implementation

Implements the HLD + decisions you provided:
- Kafka event-driven ingestion pipeline (SoE) and SoI projections
- Single canonical data model end-to-end (shared contracts)
- Dedupe by sha256 + metadata match (default return existing)
- `force_new_version=true` allows new version referencing the same evidence file
- Version statuses: PENDING/ACTIVE/SUPERSEDED/FAILED only (stage visibility via events)
- Storage: S3-compatible (MinIO for dev) via adapter, signed URLs for reads
- Canonical artifacts stored: stable_text, page_map, layout_map
- char_map/char_boxes: NOT generated by default (lazy endpoint placeholder)
- Deterministic chunk_set generated now (rows in chunks + artifact kind=chunk_set)
- RBAC: JWT roles (roles array, fallback scope string); uploaded_by=sub

## Quick start (dev)
1) Run infra:
```bash
docker compose up -d
```
2) Apply migration:
```bash
docker compose exec epic1 bash -lc "python -m app.tools.migrate"
```
3) Run API:
```bash
docker compose exec epic1 bash -lc "uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload"
```
4) Run workers (separate terminals):
```bash
docker compose exec epic1 bash -lc "python -m app.workers.worker_canonicalize"
docker compose exec epic1 bash -lc "python -m app.workers.worker_llm"
docker compose exec epic1 bash -lc "python -m app.workers.worker_soi"
```

API docs: http://localhost:8000/docs

## Auth (dev)
Set `AUTH_MODE=none` (default in compose) to bypass JWT.
